\documentclass[
	extrafontsizes, {{ info_target.font_size }},
	{% if info_target.reader == "print"  %}
		% print settings
		twoside,openright,
	{% elif info_target.reader == "digital"  %}
		% digital settings
		oneside,openany,
	{% else  %}
		\invalidReader,
	{% endif %}
	{% if info_target.size == "hd720"  %}
		% hd720 page_size settings (7.3774614536439in x 13.1154870287in)
		a4paper, % will still change in the geometry
	{% elif info_target.size == "wxgap"  %}
		% wxgap page_size settings (7.7765271812035in x 12.442443489926in)
		a4paper, % will still change in the geometry
	{% elif info_target.size == "xga"  %}
		% xga page_size settings (8.5151174390022in x 11.35348991867in)
		a4paper, % will still change in the geometry
	{% else  %}
		% some standard page_size setting
		{{ info_target.size }},
	{% endif %}
	{{ info_target.orientation }}
]{memoir}

% custom geometry for non-default paper-size (such as hd720)
{% include "latex/preamble/custom_geometry.tex" %}

% geometry is only used for the cover page
% otherwise memoir tools are used instead of geometry package
\usepackage[pass]{geometry}

% TODO: remove this..?
% info.target.reset_footer_active
% info.target.reset_footer_depth: 0

% TODO: remove this..?
% info.target.clear_page_active: true
% info.target.clear_page_depth: 1

% language inclusion should be pretty early
{% include "latex/preamble/lang.tex" %}

% pdf size optimization
% TODO: put this meta-stuff into somewhere else
% perhaps also keep it after the language thing
\pdfminorversion=6
\pdfcompresslevel=9
\pdfobjcompresslevel=3

% shortcuts
\usepackage{xcolor}
\usepackage{latexsym}
% \def \utfbox {\nopagebreak\hfill □}
\def \utfboxraw {\hfill\color{black!08}$\Box$\color{black}}
\def \utfbox {\nopagebreak\utfboxraw}
\def \texthash {\#}
\def \endsec {\utfbox\clearpage}
\def \endfoot {\setcounter{footnote}{0}}

\setcounter{tocdepth}{->{{ info_target.toc_depth }}}

{% include "latex/preamble/footnote.tex" %}

{% include "latex/preamble/cover.tex" %}

\usepackage[footnotes,hybrid,underscores=false]{markdown}
%\usepackage[hybrid]{markdown}
\markdownSetup{
	rendererPrototypes={
    	link = {(links nor working for now)}
    	% link = {\href{=>#2}{=>#1}\footnoteB{\href{->#2}{=>{\ttfamily\scriptsize\relax$ \langle $#2$ \rangle $}}}}

		% old latex mobile
		% \markdownSetup{rendererPrototypes={
		%   link = {\href{=>#2}{=>#1}}
		% }}

		% old latex non-mobile
		% \markdownSetup{rendererPrototypes={
		% link = {\href{=>#2}{=>#1}\footnoteB{\href{=>#2}{=>{\ttfamily\scriptsize\relax$ \langle $#2$ \rangle $}}}}
		% }}
	},
	renderers = {
		olItemWithNumber = {\item},
	}
}

% TODO: must analyze this..
% idk why this hidelinks is in there..
\usepackage[hidelinks]{hyperref}


% TODO: review this stuff here
{% if sent_initial == "Zallman"  %}

	\input Zallman.fd
	\newcommand*\initialsfamily{\usefont{U}{Zallman}{xl}{n}}
	\renewcommand{\LettrineFontHook}{\initialsfamily}

	% TODO: Zallman may not fit alongside sans-serif fonts

	% I think this would only work for xelatex
	% in a xelatex version, with the uchar auto stuff,
	% before #2 and then after #2 the transitions had to be dis/enabled
	% \newcommand{\DECORATE}[3][]{\lettrine[lines=3,loversize=-.055,#1]{\disableTransitionRules#2\enableTransitionRules}{->#3}}

	% previous setting..
	% \newcommand{\DECORATE}[3][]{\lettrine[lines=3,loversize=-.055,#1]{->#2}{->#3}}

	\newcommand{\DECORATE}[3][]{\lettrine[lines=3,loversize=+.115,#1]{->#2}{->#3}}

{% else %}
	\newcommand{\DECORATE}[3][]{\lettrine[lines=3,loversize=-.055,#1]{->#2}{->#3}}
{% endif %}

% prev loversize: +0.115

% TODO: idk what this is
% \newfont{\initial}{wcmr17 at 48pt}
% \newcommand{\frstltr}[1]{
%     \newbox{\litera}
%     \savebox{\litera}{\hbox #1}
%     % \savebox{\litera}{\hbox{\initial #1}}
%     \vspace*{.2\ht\litera}\par\noindent
%     \begin{wrapfigure}{l}{.8\wd\litera}
%     \vbox to .05\ht\litera{\vss\usebox{\litera}\vspace*{-.65\ht\litera}}
%     \vspace*{-.2\ht\litera}
%     \end{wrapfigure}}
% \frstltr{Д}олжно работать!

{% include "latex/preamble/custom_page_style.tex" %}
